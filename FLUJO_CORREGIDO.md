# ğŸ”„ Flujo de ConversiÃ³n Faith â†’ HEX (CORREGIDO)

## Diagrama de Flujo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIO INICIA CONVERSIÃ“N                â”‚
â”‚                     (Faith â†’ HEX Token)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. VALIDACIÃ“N                                              â”‚
â”‚     âœ“ Faith amount >= CONVERSION_RATE                      â”‚
â”‚     âœ“ Wallet conectada                                     â”‚
â”‚     âœ“ Balance OCT >= 0.05                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. CONSTRUCCIÃ“N PTB (Programmable Transaction Block)      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ const tx = new Transaction();                     â”‚  â”‚
â”‚     â”‚ tx.setSender(account.address);                    â”‚  â”‚
â”‚     â”‚                                                    â”‚  â”‚
â”‚     â”‚ tx.moveCall({                                     â”‚  â”‚
â”‚     â”‚   target: "package::hex_token::mint_from_faith_   â”‚  â”‚
â”‚     â”‚           public",                                â”‚  â”‚
â”‚     â”‚   arguments: [                                    â”‚  â”‚
â”‚     â”‚     tx.object(TREASURY_HOLDER),    // âœ… Correctoâ”‚  â”‚
â”‚     â”‚     tx.object(ECONOMY_STATS),      // âœ… Correctoâ”‚  â”‚
â”‚     â”‚     tx.pure.u64(faithAmount),      // âœ… Correctoâ”‚  â”‚
â”‚     â”‚     tx.pure.u64(conversionRate),   // âœ… Correctoâ”‚  â”‚
â”‚     â”‚   ]                                               â”‚  â”‚
â”‚     â”‚ });                                               â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  âš¡ SDK maneja automÃ¡ticamente:                            â”‚
â”‚     â€¢ Gas coin selection                                   â”‚
â”‚     â€¢ Gas budget (via dry-run)                            â”‚
â”‚     â€¢ Gas price (reference price)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. FIRMA Y EJECUCIÃ“N (OneWallet)                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ await wallet.signAndExecuteTransactionBlock({    â”‚  â”‚
â”‚     â”‚   transactionBlock: tx,                          â”‚  â”‚
â”‚     â”‚   account: account,                              â”‚  â”‚
â”‚     â”‚   chain: chainId,                                â”‚  â”‚
â”‚     â”‚   options: {                                     â”‚  â”‚
â”‚     â”‚     showEffects: true,                           â”‚  â”‚
â”‚     â”‚     showEvents: true                             â”‚  â”‚
â”‚     â”‚   }                                              â”‚  â”‚
â”‚     â”‚ });                                              â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. EJECUCIÃ“N EN ONECHAIN                                  â”‚
â”‚                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚     â”‚ Consensus   â”‚â”€â”€â”€â”€â”€â–¶â”‚ Sequencing   â”‚                 â”‚
â”‚     â”‚ (Shared Obj)â”‚      â”‚ (Validators) â”‚                 â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                 â”‚                          â”‚
â”‚                                 â–¼                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚  hex_token Contract     â”‚            â”‚
â”‚                    â”‚                         â”‚            â”‚
â”‚                    â”‚  mint_from_faith_public â”‚            â”‚
â”‚                    â”‚  â”œâ”€ Update Treasury     â”‚            â”‚
â”‚                    â”‚  â”œâ”€ Update Stats        â”‚            â”‚
â”‚                    â”‚  â”œâ”€ Mint HEX coins      â”‚            â”‚
â”‚                    â”‚  â””â”€ Transfer to user    â”‚            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                              â”‚                             â”‚
â”‚                              â–¼                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚  Emit Event:            â”‚            â”‚
â”‚                    â”‚  FaithConverted {       â”‚            â”‚
â”‚                    â”‚    player,              â”‚            â”‚
â”‚                    â”‚    faith_amount,        â”‚            â”‚
â”‚                    â”‚    hex_minted           â”‚            â”‚
â”‚                    â”‚  }                      â”‚            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. CONFIRMACIÃ“N                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ await client.waitForTransaction(digest);         â”‚  â”‚
â”‚     â”‚                                                   â”‚  â”‚
â”‚     â”‚ âœ“ Verificar status === 'success'                 â”‚  â”‚
â”‚     â”‚ âœ“ Leer eventos emitidos                          â”‚  â”‚
â”‚     â”‚ âœ“ Confirmar balance actualizado                  â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  âœ… CONVERSIÃ“N EXITOSA                      â”‚
â”‚                                                             â”‚
â”‚  â€¢ Faith deducido: {faithAmount}                           â”‚
â”‚  â€¢ HEX recibido: {hexAmount}                               â”‚
â”‚  â€¢ Gas usado: ~0.01-0.02 OCT                               â”‚
â”‚  â€¢ Digest: {transactionDigest}                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ Puntos Clave

### âœ… Correcciones Aplicadas

1. **SerializaciÃ³n AutomÃ¡tica**
   - `tx.pure.u64(value)` en lugar de BCS manual
   - SDK maneja tipos automÃ¡ticamente

2. **Objetos Compartidos Simplificados**
   - `tx.object(id)` resuelve versiones automÃ¡ticamente
   - No requiere informaciÃ³n previa del objeto

3. **Gas AutomÃ¡tico**
   - SDK hace dry-run para estimar gas
   - Selecciona y merge coins automÃ¡ticamente
   - Usa reference gas price

4. **Un Solo Intento**
   - Chain ID principal del account
   - Mensajes de error claros y especÃ­ficos

### âš¡ Ventajas

| Aspecto | Mejora |
|---------|--------|
| Simplicidad | -100 lÃ­neas de cÃ³digo |
| Gas Cost | ~90% menos (0.01 vs 0.1 OCT) |
| Confiabilidad | Sigue estÃ¡ndares oficiales |
| Mantenibilidad | CÃ³digo mÃ¡s legible |
| Debugging | Errores mÃ¡s claros |

### ğŸ¯ Requisitos

- OneWallet conectada a **Testnet**
- Balance mÃ­nimo: **0.05 OCT**
- Faith mÃ­nimo: **{CONVERSION_RATE}**

### ğŸ” VerificaciÃ³n

```typescript
// La transacciÃ³n debe incluir:
âœ“ 1 moveCall command
âœ“ 2 shared objects (TreasuryHolder, EconomyStats)
âœ“ 2 valores u64 (faithAmount, conversionRate)
âœ“ Sender establecido
âœ“ Gas manejado por SDK
```

## ğŸ“š Referencias

- **OneChain Docs**: Building Programmable Transaction Blocks
- **Move Contract**: `hex_token::mint_from_faith_public`
- **Wallet Standard**: `sui:signAndExecuteTransactionBlock`

---
*Diagrama actualizado segÃºn documentaciÃ³n oficial de OneChain*
